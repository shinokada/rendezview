<?php
/*
|--------------------------------------------------------------------------
| Widget Controller
|--------------------------------------------------------------------------
|
| An example controller that uses the pre-baked RESTful resource controller
| actions for index, create, store, show, edit, update, destroy, as well as a
| delete method to show the record before deletion.
|
| See routes.php  ->
| Route::resource('widget', 'WidgetController');
| Route::get('widget/{widget}/delete', 'WidgetController@delete');
|
*/

class EventController extends BaseController
{
    /**
     * Display a listing of the resource.
     *
     * @return Response
     */
    public function index()
    {
        // get all the rooms
        // $events = Event::all();

        // load the view and pass the rooms
        return View::make('event.index');
        // ->with('events', $events);
    }

    public function get_events()
    {

        // List of events
        $json = array();

             // Query that retrieves events
        $query = "SELECT * FROM rv_events ORDER BY id";

             // connection to the database
        try {
            $db = new PDO('mysql:host=localhost;dbname=58', 'evan', '3v0lve2oo9!');
        } catch(Exception $e) {
            exit('Unable to connect to database.');
        }
             // Execute the query
        $result = $db->query($query) or die(print_r($db->errorInfo()));

             // sending the encoded result to success page
        echo json_encode($result->fetchAll(PDO::FETCH_ASSOC));

    }

    public function add_event()
    {

        // Values received via ajax
        $title = $_POST['title'];
        $start = $_POST['start'];
        $end = $_POST['end'];

        // connection to the database
        try {
            $db = new PDO('mysql:host=localhost;dbname=58', 'evan', '3v0lve2oo9!');
        } catch(Exception $e) {
            exit('Unable to connect to database.');
        }

        // insert the records
        $sql = "INSERT INTO rv_events (title, start, end) VALUES (:title, :start, :end )";
        $q = $db->prepare($sql);
        $q->execute(array(':title'=>$title, ':start'=>$start, ':end'=>$end));

    }
}
